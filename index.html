<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#15120f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Portal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Cormorant+SC:wght@300;400&display=swap" rel="stylesheet">
<style>

/* --- Accessibility / Neurodivergent-friendly defaults --- */
:root{
  --base-font-size: 24px;
  --base-line-height: 1.7;
  --base-letter-spacing: 0.01em;
  --base-word-spacing: 0.02em;
}
html{ font-size: var(--base-font-size); }
body{
  line-height: var(--base-line-height);
  letter-spacing: var(--base-letter-spacing);
  word-spacing: var(--base-word-spacing);
  -webkit-text-size-adjust: 100%;
  text-rendering: optimizeLegibility;
}
button, .top-btn, .seg-btn, .pill, .icon-btn{
  min-height: 44px;
  min-width: 44px;
  font-size: 1rem;
}
:focus-visible{
  outline: 3px solid rgba(237,224,206,0.9);
  outline-offset: 3px;
}
@media (prefers-reduced-motion: reduce){
  *{ animation: none !important; transition: none !important; scroll-behavior: auto !important; }
}
::selection{ background: rgba(201,169,122,0.35); }

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:          #15120f;
  --cream:       #ede0ce;
  --cream-dim:   rgba(237,224,206,0.52);
  --cream-ghost: rgba(237,224,206,0.18);
  --warm:        rgba(201,169,122,0.68);
  --warm-glow:   rgba(201,169,122,0.09);
}

html, body {
  height: 100%; overflow: hidden;
  background: var(--bg);
  user-select: none;
  -webkit-font-smoothing: antialiased;
  -webkit-tap-highlight-color: transparent;
  cursor: default;
}

/* GRAIN */
.grain {
  position: fixed; inset: -50%; width: 200%; height: 200%;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.055'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 1;
  animation: grainshift 7s steps(2) infinite;
}
@keyframes grainshift {
  0%   { transform: translate(0,0) }
  25%  { transform: translate(-2%,-1%) }
  50%  { transform: translate(1%,2%) }
  75%  { transform: translate(-1%,1%) }
  100% { transform: translate(0,0) }
}

/* CHROMATIC BG */
.chromatic {
  position: fixed; inset: 0; pointer-events: none; z-index: 0;
  animation: chromashift 28s ease-in-out infinite;
}
@keyframes chromashift {
  0%,100% { background: radial-gradient(ellipse 100% 80% at 50% 100%, rgba(20,10,30,0.38) 0%, transparent 70%); }
  33%     { background: radial-gradient(ellipse 100% 80% at 50% 100%, rgba(30,8,12,0.32) 0%, transparent 70%); }
  66%     { background: radial-gradient(ellipse 100% 80% at 50% 100%, rgba(8,12,28,0.36) 0%, transparent 70%); }
}

/* WELCOME */
#screen-welcome {
  position: fixed; inset: 0; z-index: 30;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  background: radial-gradient(ellipse 75% 75% at 50% 50%, #100e0b 0%, #050403 100%);
  transition: opacity 1.4s cubic-bezier(0.4,0,0.2,1);
}
#screen-welcome.exiting { opacity: 0; pointer-events: none; }

.stars { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
.star {
  position: absolute; border-radius: 50%;
  background: rgba(255,240,220,0.95);
  animation: startwinkle var(--dur,4s) ease-in-out infinite var(--del,0s);
}
@keyframes startwinkle {
  0%,100% { opacity: var(--lo,0.15); }
  50%     { opacity: var(--hi,0.7); }
}

.mirror-wrap {
  position: relative;
  width: min(68vw, 300px); height: min(68vw, 300px);
  margin-bottom: 36px;
  cursor: pointer;
}
.mirror-ring {
  position: absolute; inset: 0; border-radius: 50%;
  border: 1px solid rgba(255,210,150,0.85);
  animation: mirrorpulse 6s ease-in-out infinite;
  pointer-events: none;
}
.mirror-ring-2 {
  position: absolute; inset: 9px; border-radius: 50%;
  border: 1px solid rgba(255,210,150,0.55);
  animation: mirrorpulse 6s ease-in-out infinite 0.6s;
  pointer-events: none;
}
@keyframes mirrorpulse {
  0%,100% { opacity: 0.6; transform: scale(1); }
  50%     { opacity: 1;   transform: scale(1.013); }
}
canvas#mirror {
  position: absolute; inset: 0; width: 100%; height: 100%;
  border-radius: 50%; display: block;
}
.mirror-tap-hint {
  position: absolute; bottom: -28px; left: 50%;
  transform: translateX(-50%);
  font-family: 'Cormorant SC', serif;
  font-size: 9px; font-weight: 300;
  letter-spacing: 0.35em;
  color: rgba(237,224,206,0.14);
  white-space: nowrap;
  opacity: 0;
  animation: softrise 2s ease forwards 2.8s;
}

.welcome-wordmark {
  font-family: 'Cormorant SC', serif;
  font-size: clamp(11px, 2.8vw, 14px);
  font-weight: 300;
  color: rgba(255,240,220,0.75);
  letter-spacing: 0.52em;
  margin-bottom: 22px;
  opacity: 0;
  animation: softrise 2s ease forwards 0.3s;
}

.welcome-line {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(20px, 5.2vw, 28px);
  font-weight: 300; font-style: italic;
  color: var(--cream-dim);
  text-align: center;
  line-height: 1.55;
  letter-spacing: 0.02em;
  margin-bottom: 44px;
  opacity: 0;
  animation: softrise 2s ease forwards 0.9s;
}

.mode-glyphs {
  display: flex; gap: 28px; align-items: center;
  margin-top: 8px;
  opacity: 0;
  animation: softrise 2s ease forwards 1.8s;
}
.mode-glyph {
  display: flex; flex-direction: column; align-items: center; gap: 7px;
  cursor: pointer; padding: 6px 10px;
  transition: opacity 0.4s ease;
  opacity: 0.35;
  -webkit-tap-highlight-color: transparent;
}
.mode-glyph.active { opacity: 1; }
.mode-glyph:hover  { opacity: 0.75; }

.glyph-icon {
  width: 18px; height: 18px;
  display: flex; align-items: center; justify-content: center;
}
.glyph-instant { width: 1px; height: 18px; background: rgba(201,169,122,0.7); }
.glyph-deep {
  width: 18px; height: 18px; position: relative;
  border: 1px solid rgba(201,169,122,0.6);
  border-radius: 50%;
}
.glyph-deep::before {
  content: ''; position: absolute; inset: 4px;
  border: 1px solid rgba(201,169,122,0.4);
  border-radius: 50%;
}
.glyph-deep::after {
  content: ''; position: absolute; inset: 8px;
  background: rgba(201,169,122,0.5);
  border-radius: 50%;
}
.glyph-still { width: 18px; height: 1px; background: rgba(201,169,122,0.7); }

.glyph-label {
  font-family: 'Cormorant SC', serif;
  font-size: 8px; font-weight: 300;
  letter-spacing: 0.32em;
  color: rgba(237,224,206,0.4);
  text-transform: uppercase;
}
.mode-glyph.active .glyph-label { color: rgba(237,224,206,0.65); }

@keyframes softrise {
  from { opacity: 0; transform: translateY(9px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* BREATH */
#screen-breath {
  position: fixed; inset: 0; z-index: 25;
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
  background: #080706;
  opacity: 0; transition: opacity 0.9s ease;
}
#screen-breath.visible { display: flex; }
#screen-breath.active  { opacity: 1; }

.breath-orb-wrap {
  position: relative;
  width: min(52vw, 210px); height: min(52vw, 210px);
}
.breath-orb, .breath-orb-inner, .breath-orb-core {
  position: absolute; border-radius: 50%;
  animation: breathe 8s cubic-bezier(0.45,0.05,0.55,0.95) infinite;
}
.breath-orb {
  inset: 0;
  background: radial-gradient(ellipse at 40% 38%, rgba(237,224,206,0.14) 0%, rgba(201,169,122,0.05) 50%, transparent 75%);
  border: 1px solid rgba(201,169,122,0.2);
}
.breath-orb-inner {
  inset: 18%;
  background: radial-gradient(ellipse at 40% 38%, rgba(237,224,206,0.1) 0%, transparent 70%);
  border: 1px solid rgba(201,169,122,0.1);
  animation-delay: 0.15s;
}
.breath-orb-core {
  inset: 36%;
  background: radial-gradient(ellipse at 40% 38%, rgba(237,224,206,0.2) 0%, transparent 70%);
  animation-delay: 0.3s;
}
@keyframes breathe {
  0%,100% { transform: scale(0.82); opacity: 0.5; }
  45%,55% { transform: scale(1.0);  opacity: 1; }
}

/* INTERIOR */
#interior {
  position: fixed; inset: 0; z-index: 10;
  display: none; opacity: 0;
  transition: opacity 1.2s ease 0.2s;
}
#interior.visible { display: block; }
#interior.active  { opacity: 1; }

.world { position: fixed; inset: 0; display: flex; }
.world-l { flex:1; background: #1c1814; }
.world-r { flex:1; background: #201b16; }

.ambient {
  position: fixed; inset: 0; pointer-events: none; z-index: 2;
  background:
    radial-gradient(ellipse 45% 70% at 50% 50%, rgba(255,210,150,0.16) 0%, transparent 65%),
    radial-gradient(ellipse 70% 30% at 50% 108%, rgba(255,210,150,0.12) 0%, transparent 55%);
  animation: ambientbreathe 9s ease-in-out infinite;
}
@keyframes ambientbreathe { 0%,100%{opacity:.7} 50%{opacity:1} }

.vignette {
  position: fixed; inset: 0; pointer-events: none; z-index: 3;
  background: radial-gradient(ellipse 82% 82% at 50% 50%, transparent 22%, rgba(10,8,6,0.55) 100%);
}

.door-wrap {
  position: fixed; left: 50%; top: 0; bottom: 0;
  transform: translateX(-50%);
  width: 120px; z-index: 5; pointer-events: none;
  transition: transform 0.1s linear;
}
.door-line {
  position: absolute; left: 50%; top: 0; bottom: 0; width: 1px;
  transform: translateX(-50%);
  background: linear-gradient(180deg,
    transparent 0%, rgba(201,169,122,0.25) 4%,
    rgba(201,169,122,0.65) 18%, rgba(201,169,122,0.06) 30%,
    rgba(201,169,122,0.03) 50%,
    rgba(201,169,122,0.06) 70%, rgba(201,169,122,0.65) 82%,
    rgba(201,169,122,0.25) 96%, transparent 100%);
  animation: doorbreathe 6s ease-in-out infinite;
}
.door-glow {
  position: absolute; left: 50%; top: 0; bottom: 0; width: 80px;
  transform: translateX(-50%);
  background: radial-gradient(ellipse 100% 55% at 50% 50%, rgba(201,169,122,0.09) 0%, transparent 100%);
  animation: doorbreathe 6s ease-in-out infinite;
}
@keyframes doorbreathe { 0%,100%{opacity:.62} 50%{opacity:1} }

.door-lintel {
  position: fixed; left: 50%; top: 6vh; transform: translateX(-50%);
  width: 88px; height: 1px; z-index: 6;
  background: linear-gradient(90deg, transparent, rgba(201,169,122,0.62), transparent);
  animation: doorbreathe 6s ease-in-out infinite;
}
.door-sill {
  position: fixed; left: 50%; bottom: 6vh; transform: translateX(-50%);
  width: 58px; height: 1px; z-index: 6;
  background: linear-gradient(90deg, transparent, rgba(201,169,122,0.42), transparent);
  animation: doorbreathe 6s ease-in-out infinite;
}
.door-serif { position: fixed; z-index: 6; width: 10px; height: 1px; background: rgba(201,169,122,0.5); }
.door-serif.tl { top: 6vh;    left:  calc(50% - 44px); }
.door-serif.tr { top: 6vh;    right: calc(50% - 44px); }
.door-serif.bl { bottom: 6vh; left:  calc(50% - 29px); }
.door-serif.br { bottom: 6vh; right: calc(50% - 29px); }

.i-wordmark {
  position: fixed; top: 0; left: 0; right: 0;
  display: flex; flex-direction: column; align-items: center;
  padding-top: calc(max(env(safe-area-inset-top), 14px) + 14px);
  z-index: 20; pointer-events: none;
}
.i-wordmark-text {
  font-family: 'Cormorant SC', serif;
  font-size: clamp(11px, 2.6vw, 14px); font-weight: 300;
  letter-spacing: 0.5em; color: rgba(255,240,220,0.65);
}
.i-wordmark-rule {
  width: 28px; height: 1px;
  background: rgba(201,169,122,0.28); margin-top: 7px;
}

.i-mode-indicator {
  position: fixed; top: calc(max(env(safe-area-inset-top), 14px) + 52px);
  left: 50%; transform: translateX(-50%);
  z-index: 20; pointer-events: none;
  font-family: 'Cormorant SC', serif;
  font-size: 8px; font-weight: 300;
  letter-spacing: 0.38em;
  color: rgba(237,224,206,0.1);
}

/* QUESTION */
#iscreen-question {
  position: fixed; inset: 0; z-index: 15;
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 88px clamp(28px, 9vw, 80px) 110px;
}
#iscreen-question.visible { display: flex; }

.question-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(32px, 8.5vw, 48px);
  font-weight: 400; font-style: italic;
  color: var(--cream);
  text-align: center; line-height: 1.45;
  letter-spacing: 0.01em;
  max-width: 580px; margin-bottom: 36px;
  opacity: 0;
  position: relative; z-index: 16;
}
.anchor-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(17px, 4.2vw, 22px);
  font-weight: 300;
  color: rgba(237,224,206,0.72);
  text-align: center; line-height: 1.75;
  letter-spacing: 0.04em;
  max-width: 440px;
  opacity: 0; transition: opacity 2.5s ease;
  position: relative; z-index: 16;
}
.deepener-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(15px, 3.5vw, 18px);
  font-style: italic;
  color: rgba(237,224,206,0.42);
  text-align: center; letter-spacing: 0.03em;
  max-width: 380px; margin-top: 28px;
  opacity: 0; transition: opacity 3s ease;
  position: relative; z-index: 16;
}
.deepener-text.on { opacity: 1; }

/* STATEMENT */
#iscreen-statement {
  position: fixed; inset: 0; z-index: 15;
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 88px clamp(28px, 9vw, 80px) 110px;
}
#iscreen-statement.visible { display: flex; }

.statement-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(26px, 6.5vw, 38px);
  font-weight: 300;
  color: var(--cream);
  text-align: center; line-height: 1.62;
  letter-spacing: 0.02em;
  max-width: 560px;
  opacity: 0; transition: opacity 3s ease;
  position: relative; z-index: 16;
}
.statement-text.on { opacity: 1; }

/* STILL */
#iscreen-still {
  position: fixed; inset: 0; z-index: 15;
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
}
#iscreen-still.visible { display: flex; }

.still-text {
  font-family: 'Cormorant SC', serif;
  font-size: clamp(10px, 2.4vw, 13px);
  font-weight: 300; letter-spacing: 0.45em;
  color: rgba(237,224,206,0.12);
  text-align: center;
  opacity: 0; transition: opacity 4s ease;
}
.still-text.on { opacity: 1; }

/* CLOSING */
#iscreen-close {
  position: fixed; inset: 0; z-index: 15;
  display: none; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 88px clamp(28px, 9vw, 80px) 110px;
}
#iscreen-close.visible { display: flex; }

.closing-text {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(22px, 5.5vw, 32px);
  font-weight: 300; font-style: italic;
  color: rgba(237,224,206,0.72);
  text-align: center; line-height: 1.72;
  letter-spacing: 0.025em;
  max-width: 500px;
  opacity: 0; transition: opacity 2.5s ease;
  white-space: pre-line;
  position: relative; z-index: 16;
}
.closing-text.on { opacity: 1; }

.return-btn {
  font-family: 'Cormorant SC', serif;
  font-size: clamp(13px, 3vw, 15px); font-weight: 400;
  letter-spacing: 0.38em; color: rgba(237,224,206,0.55);
  background: transparent; border: none;
  margin-top: 52px; cursor: pointer;
  opacity: 0; transition: opacity 2s ease, color 0.5s;
  -webkit-tap-highlight-color: transparent;
  padding: 16px 32px;
}
.return-btn.on { opacity: 1; }
.return-btn:hover { color: var(--cream-dim); }

/* NEXT BUTTON */
.next-btn {
  position: fixed;
  bottom: calc(max(env(safe-area-inset-bottom), 18px) + 18px);
  left: 50%; transform: translateX(-50%);
  z-index: 25;
  display: none; flex-direction: column; align-items: center; gap: 10px;
  background: transparent; border: none; cursor: pointer;
  opacity: 0; transition: opacity 1.5s ease;
  -webkit-tap-highlight-color: transparent;
  padding: 16px 32px;
  min-width: 160px;
}
.next-btn.visible { opacity: 1; }
.next-btn-arrow { width: 1px; height: 32px; background: linear-gradient(180deg, transparent, rgba(201,169,122,0.7)); }
.next-btn-label {
  font-family: 'Cormorant SC', serif;
  font-size: clamp(13px, 3vw, 15px); font-weight: 400;
  letter-spacing: 0.32em; color: rgba(237,224,206,0.65);
}

.whisper {
  position: fixed; pointer-events: none; z-index: 8;
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(9px, 1.8vw, 11px); font-style: italic;
  color: rgba(237,224,206,0.055);
  line-height: 1.9; max-width: 90px;
  opacity: 0; transition: opacity 4s ease;
}
.whisper.on { opacity: 1; }
.whisper-l { left: 10px; top: 50%; transform: translateY(-50%); }
.whisper-r { right: 10px; top: 50%; transform: translateY(-50%); text-align: right; }

.locked-msg {
  position: fixed; top: 50%; left: 50%;
  transform: translate(-50%, calc(-50% - 130px));
  z-index: 20; pointer-events: none;
  font-family: 'Cormorant SC', serif;
  font-size: 9px; letter-spacing: 0.36em;
  color: rgba(237,224,206,0.1);
  opacity: 0; transition: opacity 2s ease;
}
.locked-msg.on { opacity: 1; }

.visit-count {
  position: fixed; bottom: 18px; left: 20px; z-index: 20;
  font-family: 'Cormorant SC', serif;
  font-size: 9px; font-weight: 300; letter-spacing: 0.3em;
  color: rgba(237,224,206,0.08);
}
</style>
</head>
<body>

<div class="grain"></div>
<div class="chromatic"></div>

<div id="screen-welcome">
  <div class="stars" id="stars"></div>
  <p class="welcome-wordmark">Portal</p>
  <div class="mirror-wrap" id="mirror-wrap">
    <canvas id="mirror"></canvas>
    <div class="mirror-ring"></div>
    <div class="mirror-ring-2"></div>
    <span class="mirror-tap-hint">touch to enter</span>
  </div>
  <p class="welcome-line">A question is<br>waiting for you</p>
  <div class="mode-glyphs">
    <div class="mode-glyph" data-mode="instant">
      <div class="glyph-icon"><div class="glyph-instant"></div></div>
      <span class="glyph-label">Instant</span>
    </div>
    <div class="mode-glyph active" data-mode="deep">
      <div class="glyph-icon"><div class="glyph-deep"></div></div>
      <span class="glyph-label">Deep</span>
    </div>
    <div class="mode-glyph" data-mode="still">
      <div class="glyph-icon"><div class="glyph-still"></div></div>
      <span class="glyph-label">Still</span>
    </div>
  </div>
</div>

<div id="screen-breath">
  <div class="breath-orb-wrap">
    <div class="breath-orb"></div>
    <div class="breath-orb-inner"></div>
    <div class="breath-orb-core"></div>
  </div>
</div>

<div id="interior">
  <div class="world"><div class="world-l"></div><div class="world-r"></div></div>
  <div class="ambient"></div>
  <div class="vignette"></div>
  <div class="door-wrap" id="door-wrap">
    <div class="door-glow"></div>
    <div class="door-line"></div>
  </div>
  <div class="door-lintel"></div>
  <div class="door-sill"></div>
  <div class="door-serif tl"></div>
  <div class="door-serif tr"></div>
  <div class="door-serif bl"></div>
  <div class="door-serif br"></div>
</div>

<div class="i-wordmark">
  <span class="i-wordmark-text">Portal</span>
  <div class="i-wordmark-rule"></div>
</div>
<div class="i-mode-indicator" id="i-mode-indicator"></div>

<div id="iscreen-question">
  <p class="question-text" id="q-text"></p>
  <p class="anchor-text"   id="anchor-text"></p>
  <p class="deepener-text" id="deepener-text"></p>
</div>

<div id="iscreen-statement">
  <p class="statement-text" id="s-text"></p>
</div>

<div id="iscreen-still">
  <p class="still-text" id="still-text">just this</p>
</div>

<div id="iscreen-close">
  <p class="closing-text" id="closing-text"></p>
  <button class="return-btn" id="return-btn">Return</button>
</div>

<p class="whisper whisper-l" id="whisper-l"></p>
<p class="whisper whisper-r" id="whisper-r"></p>

<button class="next-btn" id="next-btn">
  <div class="next-btn-arrow"></div>
  <span class="next-btn-label">Another question</span>
</button>

<div class="locked-msg" id="locked-msg">sit with this one</div>
<div class="visit-count" id="visit-count"></div>

<script>
const QUESTIONS = [
  { q: "What are you pretending not to know right now?",                          a: "The body knows before the mind admits it." },
  { q: "Are we really separate from one another\u2014or is that the illusion?",  a: "Where does one breath end and the next begin?" },
  { q: "What feeling have you been calling by a safer name?",                     a: "Beneath the word is the thing itself." },
  { q: "Who are you when nothing is required of you and no one is watching?",     a: "That version has been waiting patiently." },
  { q: "Where in your body does the truth live before your mind gets to it?",     a: "Return there now. What do you notice?" },
  { q: "What have you been waiting for permission to want?",                      a: "Permission is rarely coming from outside." },
  { q: "What are you loyal to that is no longer loyal to you?",                   a: "Loyalty without reciprocity is a cage." },
  { q: "What would you feel if you stopped managing how others experience you?",  a: "The relief might arrive before the fear." },
  { q: "What version of yourself are you most tired of maintaining?",             a: "Exhaustion is a kind of honesty." },
  { q: "Who would you disappoint if you became more fully yourself?",             a: "Their face just appeared. Notice that." },
  { q: "What part of your personality is actually a very old survival strategy?", a: "It worked then. What does it cost you now?" },
  { q: "What mask has been on so long you sometimes forget it isn\u2019t your face?", a: "The skin beneath is still there." },
  { q: "What conversation have you been rehearsing but never having?",            a: "Rehearsal is another word for avoidance." },
  { q: "What would you grieve if you finally let it go?",                         a: "Grief is love with nowhere to go." },
  { q: "Whose voice is the loudest inside your head that isn\u2019t your own?",  a: "When did you first let them in?" },
  { q: "What do you do with your pain when no one is watching?",                  a: "That is your most private self." },
  { q: "What have you achieved that you thought would finally be enough?",        a: "Notice where \u2018enough\u2019 keeps moving." },
  { q: "Who are you without the story you\u2019ve been telling about yourself?",  a: "The story is not the storyteller." },
  { q: "What is the kindest thing you could do for yourself today that you won\u2019t do?", a: "Why won\u2019t you?" },
  { q: "What are you afraid would happen if you were truly seen?",                a: "Something in you chose to ask this today." },
  { q: "What do you keep almost saying?",                                         a: "The almost is the most important part." },
  { q: "What chapter of your life is asking to be closed?",                       a: "The door has been ajar for a while now." },
  { q: "What truth are you packaging in humour so it\u2019s easier to carry?",   a: "The joke and the confession are the same thing." },
  { q: "What is the difference between who you are and who you present?",         a: "The gap is not a failure. It is information." },
  { q: "What would love do here that you are not doing?",                         a: "You know the answer. You already knew." },
  { q: "Where are you living in the future instead of this moment?",              a: "This breath is the only place anything changes." },
  { q: "What are you carrying that was never yours to carry?",                    a: "You can set it down. You always could." },
  { q: "What relationship are you maintaining out of fear rather than love?",     a: "Fear and love feel similar from the inside." },
  { q: "What does your body do when you lie to yourself?",                        a: "It\u2019s been trying to tell you." },
  { q: "What is the recurring dream of your waking life?",                        a: "The image that keeps returning has something to say." },
  { q: "What have you made peace with that you haven\u2019t actually made peace with?", a: "False peace is just postponement." },
  { q: "What would the wisest version of you say about where you are right now?", a: "They are not far from here." },
  { q: "What are you punishing yourself for that deserves forgiveness?",          a: "You were doing the best you could with what you had." },
  { q: "What would you do tomorrow if you knew no one would judge you?",          a: "The freedom is already there. It\u2019s the fear that\u2019s temporary." },
  { q: "What have you forgiven others for that you haven\u2019t forgiven yourself?", a: "The standard changes depending on whose name is on it." },
  { q: "What are you most afraid to be wrong about?",                             a: "Our most defended beliefs are often our most fragile." },
  { q: "What do you want that you\u2019re embarrassed to want?",                  a: "Embarrassment is often just unexpressed desire." },
  { q: "What is the question you\u2019re afraid to ask yourself?",                a: "The fear of the question is always louder than the answer." },
  { q: "What are you doing with your one life that you wouldn\u2019t choose if you chose again today?", a: "Today is still a day you can choose." },
  { q: "Who in your life makes you feel most like yourself?",                     a: "That person is reflecting something real back at you." },
  { q: "What part of your past are you still living as if it were present?",      a: "The past has no present-tense power except what we lend it." },
  { q: "What would it feel like to stop trying to fix yourself?",                 a: "Not giving up. Just meeting yourself as you are." },
  { q: "What are you waiting to feel before you begin?",                          a: "That feeling rarely arrives before the beginning." },
  { q: "What does your exhaustion know that your ambition doesn\u2019t?",        a: "Tiredness has its own intelligence." },
  { q: "What is the most honest thing you could say about your life right now?",  a: "To yourself. No audience. Just truth." },
  { q: "Where are you spending energy maintaining a story that exhausts you?",    a: "The story costs more than the truth would." },
  { q: "What would you know about yourself if you sat in silence for an hour?",   a: "The knowing is already there. The silence stops the noise." },
  { q: "What does \u2018home\u2019 mean to you, and when did you last feel it?",  a: "Some carry it. Some are still looking." },
  { q: "What have you been waiting for that is not coming?",                      a: "The waiting is the thing to look at." },
  { q: "What would you do if you weren\u2019t performing for who you used to be?", a: "That audience may have already left." },
];

const STATEMENTS = [
  "You have been kind to everyone except yourself.",
  "The waiting has become the life.",
  "You already know which relationship this is about.",
  "The version of you that you\u2019re protecting no longer needs protection.",
  "You are not behind. You are where you are.",
  "The door you keep walking past is the one.",
  "What you call overthinking is sometimes the mind trying to love carefully.",
];

const CLOSINGS = [
  "Go gently.\nCarry it lightly.\nYou have done enough for today.",
  "The question will wait for you.\nYou don\u2019t have to solve it now.\nJust let it move through you.",
  "Return to the world softly.\nSomething in you has shifted.\nTrust that.",
  "The stillness you touched is still inside you.\nIt goes where you go.",
  "You came here for a reason\nyou may not yet fully understand.\nThat\u2019s enough.",
];

const DEEPENERS = [
  "What would it cost you to know?",
  "And underneath that?",
  "Stay a moment longer.",
  "Let it move through you.",
  "You don\u2019t have to answer. Just feel.",
];

const WHISPERS = [
  "what if","you already know","beneath this",
  "stay here","let it","not yet","almost",
  "the truth","just this","still here",
];

let mode         = 'deep';
let questionCount = 0;
let usedIdx       = [];
let currentScreen = 'welcome';
let audioCtx      = null;
let timers        = [];

const visits = parseInt(localStorage.getItem('portal_v') || '0') + 1;
localStorage.setItem('portal_v', visits);

function T(fn, ms) { timers.push(setTimeout(fn, ms)); }
function clearT()  { timers.forEach(clearTimeout); timers = []; }

(function() {
  const wrap = document.getElementById('stars');
  for (let i = 0; i < 55; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const sz = Math.random() * 1.4 + 0.4;
    s.style.cssText = `width:${sz}px;height:${sz}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--dur:${(Math.random()*5+3).toFixed(1)}s;--del:${(Math.random()*7).toFixed(1)}s;--lo:${(Math.random()*0.12+0.04).toFixed(2)};--hi:${(Math.random()*0.5+0.25).toFixed(2)};`;
    wrap.appendChild(s);
  }
})();

(function() {
  const canvas = document.getElementById('mirror');
  const ctx    = canvas.getContext('2d');
  let w, h, cx, cy, r;

  function resize() {
    const wrap = canvas.parentNode;
    w = canvas.width  = wrap.offsetWidth;
    h = canvas.height = wrap.offsetHeight;
    cx = w/2; cy = h/2; r = w/2;
  }
  resize();
  window.addEventListener('resize', resize);

  const ripples = [];
  function addRipple(x, y) { ripples.push({ x, y, radius: 2, alpha: 0.65, speed: r * 0.02 }); }

  canvas.addEventListener('click', e => {
    const rect = canvas.getBoundingClientRect();
    addRipple(e.clientX - rect.left, e.clientY - rect.top);
  });
  canvas.addEventListener('touchstart', e => {
    const rect = canvas.getBoundingClientRect();
    addRipple(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
  }, { passive: true });

  let t = 0;
  function draw() {
    ctx.clearRect(0, 0, w, h);
    ctx.save();
    ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.clip();

    const bg = ctx.createRadialGradient(cx, cy*0.8, 0, cx, cy, r);
    bg.addColorStop(0, '#3a2e22');
    bg.addColorStop(0.6, '#1c1712');
    bg.addColorStop(1, '#0d0b08');
    ctx.fillStyle = bg; ctx.fillRect(0, 0, w, h);

    for (let i = 0; i < 3; i++) {
      const phase = t * 0.35 + i * 2.2;
      const ox = Math.sin(phase * 0.7) * r * 0.28;
      const oy = Math.cos(phase * 0.5) * r * 0.28;
      const hue = (170 + i * 45 + t * 7) % 360;
      const g = ctx.createRadialGradient(cx+ox, cy+oy, 0, cx, cy, r*1.1);
      g.addColorStop(0,   `hsla(${hue},28%,72%,0.045)`);
      g.addColorStop(0.5, `hsla(${hue+35},22%,58%,0.02)`);
      g.addColorStop(1,   'transparent');
      ctx.fillStyle = g; ctx.fillRect(0, 0, w, h);
    }

    const glow = ctx.createRadialGradient(cx, cy*0.85, 0, cx, cy, r*0.72);
    glow.addColorStop(0,   'rgba(255,210,150,0.35)');
    glow.addColorStop(0.65,'rgba(255,210,150,0.15)');
    glow.addColorStop(1,   'transparent');
    ctx.fillStyle = glow; ctx.fillRect(0, 0, w, h);

    for (let i = ripples.length - 1; i >= 0; i--) {
      const rp = ripples[i];
      ctx.beginPath(); ctx.arc(rp.x, rp.y, rp.radius, 0, Math.PI*2);
      ctx.strokeStyle = `rgba(237,224,206,${rp.alpha})`;
      ctx.lineWidth = 1; ctx.stroke();
      rp.radius += rp.speed; rp.alpha -= 0.011;
      if (rp.alpha <= 0) ripples.splice(i, 1);
    }

    ctx.restore();
    t += 0.007;
    requestAnimationFrame(draw);
  }
  draw();
})();

window.addEventListener('deviceorientation', e => {
  const dw = document.getElementById('door-wrap');
  if (!dw) return;
  const tilt = Math.max(-7, Math.min(7, (e.gamma || 0) * 0.14));
  dw.style.transform = `translateX(calc(-50% + ${tilt}px))`;
});

function startAudio() {
  if (audioCtx) return;
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    [[432, 0.055], [864, 0.018], [216, 0.014], [144, 0.01]].forEach(([freq, vol], i) => {
      const osc  = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const lfo  = audioCtx.createOscillator();
      const lfoG = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.value = freq;
      lfo.frequency.value = 0.1 + i * 0.06;
      lfoG.gain.value = freq * 0.0007;
      lfo.connect(lfoG); lfoG.connect(osc.frequency);
      gain.gain.setValueAtTime(0, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(vol, audioCtx.currentTime + (mode === 'instant' ? 2 : 6));
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(); lfo.start();
    });
    if (mode !== 'still') {
      const et = audioCtx.createOscillator();
      const eg = audioCtx.createGain();
      et.frequency.value = 108;
      eg.gain.setValueAtTime(0.055, audioCtx.currentTime);
      eg.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 5);
      et.connect(eg); eg.connect(audioCtx.destination);
      et.start(); et.stop(audioCtx.currentTime + 5);
    }
  } catch(e) {}
}

document.querySelectorAll('.mode-glyph').forEach(el => {
  el.addEventListener('click', e => {
    e.stopPropagation();
    document.querySelectorAll('.mode-glyph').forEach(g => g.classList.remove('active'));
    el.classList.add('active');
    mode = el.getAttribute('data-mode');
  });
  el.addEventListener('touchend', e => {
    e.stopPropagation(); e.preventDefault();
    document.querySelectorAll('.mode-glyph').forEach(g => g.classList.remove('active'));
    el.classList.add('active');
    mode = el.getAttribute('data-mode');
  });
});

document.getElementById('mirror-wrap').addEventListener('click', enterPortal);
document.getElementById('mirror-wrap').addEventListener('touchend', e => { e.preventDefault(); enterPortal(); });

function enterPortal() {
  startAudio();
  const welcome = document.getElementById('screen-welcome');
  welcome.classList.add('exiting');
  setTimeout(() => welcome.style.display = 'none', 1500);
  if (mode === 'instant') showInterior(600);
  else if (mode === 'deep') showBreath();
  else if (mode === 'still') showInterior(600, true);
}

function showBreath() {
  const b = document.getElementById('screen-breath');
  b.classList.add('visible');
  setTimeout(() => b.classList.add('active'), 50);
  setTimeout(() => {
    b.classList.remove('active');
    setTimeout(() => { b.classList.remove('visible'); showInterior(400); }, 900);
  }, 4500);
}

function showInterior(delay, stillMode) {
  setTimeout(() => {
    const interior = document.getElementById('interior');
    interior.classList.add('visible');
    setTimeout(() => interior.classList.add('active'), 50);
    const labels = { instant: 'instant', deep: 'deep', still: 'still' };
    document.getElementById('i-mode-indicator').textContent = labels[mode] || '';
    if (visits > 1) document.getElementById('visit-count').textContent = visits;
    setTimeout(() => { if (mode === 'still') displayStill(); else displayQuestion(); }, 1100);
  }, delay);
}

function showIScreen(id) {
  ['iscreen-question','iscreen-statement','iscreen-close','iscreen-still'].forEach(sid => {
    const el = document.getElementById(sid);
    if (el) el.classList.remove('visible');
  });
  const t = document.getElementById(id);
  if (t) { t.classList.add('visible'); currentScreen = id; }
}

function dissolveIn(el, text, charDelay, startDelay) {
  el.innerHTML = '';
  el.style.opacity = '1';
  [...text].forEach((char, i) => {
    const s = document.createElement('span');
    s.textContent = char;
    s.style.cssText = `opacity:0;filter:blur(5px);display:inline;transition:opacity ${750+Math.random()*350}ms ease ${startDelay+i*charDelay}ms,filter ${650+Math.random()*250}ms ease ${startDelay+i*charDelay}ms;`;
    el.appendChild(s);
    requestAnimationFrame(() => requestAnimationFrame(() => { s.style.opacity='1'; s.style.filter='blur(0)'; }));
  });
}

function pickQ() {
  if (usedIdx.length >= QUESTIONS.length) usedIdx = [];
  let idx;
  do { idx = Math.floor(Math.random() * QUESTIONS.length); } while (usedIdx.includes(idx));
  usedIdx.push(idx); return idx;
}

function displayQuestion() {
  clearT();
  questionCount++;
  const locked = (questionCount % 7 === 0);
  const nb = document.getElementById('next-btn');
  nb.classList.remove('visible'); nb.style.display = 'none';
  document.getElementById('locked-msg').classList.remove('on');
  document.getElementById('deepener-text').classList.remove('on');
  document.querySelectorAll('.whisper').forEach(w => w.classList.remove('on'));

  if (questionCount > 1 && Math.random() < 0.07) { displayStatement(); return; }

  const item = QUESTIONS[pickQ()];
  showIScreen('iscreen-question');

  const qEl = document.getElementById('q-text');
  const aEl = document.getElementById('anchor-text');
  const dEl = document.getElementById('deepener-text');

  qEl.style.opacity = '0'; aEl.style.opacity = '0';
  dEl.classList.remove('on'); dEl.textContent = DEEPENERS[Math.floor(Math.random()*DEEPENERS.length)];

  const charDelay = mode === 'instant' ? 18 : 26;
  T(() => dissolveIn(qEl, item.q, charDelay, 0), mode === 'instant' ? 200 : 400);

  const qTime = (mode === 'instant' ? 200 : 400) + item.q.length * charDelay + 700;
  T(() => { aEl.style.transition = 'opacity 2.5s ease'; aEl.textContent = item.a; aEl.style.opacity = '1'; }, qTime);

  T(() => dEl.classList.add('on'), mode === 'instant' ? 25000 : 40000);

  if (mode === 'deep') {
    T(() => {
      const frags = [...WHISPERS].sort(() => Math.random()-0.5);
      document.getElementById('whisper-l').textContent = frags.slice(0,3).join('\n');
      document.getElementById('whisper-r').textContent = frags.slice(3,6).join('\n');
      document.querySelectorAll('.whisper').forEach(w => w.classList.add('on'));
    }, 20000);
  }

  if (locked) {
    document.getElementById('locked-msg').classList.add('on');
    T(() => { nb.style.display='flex'; setTimeout(()=>nb.classList.add('visible'),40); }, 90000);
  } else {
    const nextDelay = mode === 'instant' ? 4000 : 7000;
    T(() => { nb.style.display='flex'; setTimeout(()=>nb.classList.add('visible'),40); }, nextDelay);
  }

  T(() => {
    qEl.style.transition = 'opacity 2s ease'; qEl.style.opacity = '0.1';
    qEl.addEventListener('click', () => { qEl.style.opacity='1'; }, { once:true });
  }, 90000);

  T(showClosing, 180000);
}

function displayStatement() {
  clearT();
  const nb = document.getElementById('next-btn');
  nb.classList.remove('visible'); nb.style.display = 'none';
  showIScreen('iscreen-statement');
  const sEl = document.getElementById('s-text');
  sEl.classList.remove('on'); sEl.textContent = '';
  T(() => { sEl.textContent = STATEMENTS[Math.floor(Math.random()*STATEMENTS.length)]; sEl.classList.add('on'); }, 600);
  T(() => { nb.style.display='flex'; setTimeout(()=>nb.classList.add('visible'),40); }, 12000);
  T(showClosing, 180000);
}

function displayStill() {
  clearT();
  const nb = document.getElementById('next-btn');
  nb.classList.remove('visible'); nb.style.display = 'none';
  showIScreen('iscreen-still');
  const st = document.getElementById('still-text');
  st.classList.remove('on');
  T(() => st.classList.add('on'), 1200);
  T(showClosing, 300000);
}

function showClosing() {
  clearT();
  const nb = document.getElementById('next-btn');
  nb.classList.remove('visible'); nb.style.display = 'none';
  document.querySelectorAll('.whisper').forEach(w => w.classList.remove('on'));
  showIScreen('iscreen-close');
  const cEl  = document.getElementById('closing-text');
  const rBtn = document.getElementById('return-btn');
  cEl.classList.remove('on'); rBtn.classList.remove('on');
  cEl.textContent = CLOSINGS[Math.floor(Math.random()*CLOSINGS.length)];
  T(() => cEl.classList.add('on'), 400);
  T(() => rBtn.classList.add('on'), 3600);
}

function nextQuestion() {
  document.querySelectorAll('.whisper').forEach(w => w.classList.remove('on'));
  if (questionCount >= 3 && Math.random() > 0.65) { showClosing(); return; }
  if (mode === 'still') { displayStill(); return; }
  displayQuestion();
}

function returnToPortal() {
  clearT(); questionCount = 0;
  showIScreen('iscreen-question');
  document.getElementById('iscreen-question').classList.remove('visible');
  T(displayQuestion, 500);
}

document.getElementById('next-btn').addEventListener('click', nextQuestion);
document.getElementById('next-btn').addEventListener('touchend', e => { e.preventDefault(); nextQuestion(); });
document.getElementById('return-btn').addEventListener('click', returnToPortal);
document.getElementById('return-btn').addEventListener('touchend', e => { e.preventDefault(); returnToPortal(); });

document.addEventListener('keydown', e => {
  if (e.key !== ' ' && e.key !== 'Enter') return;
  e.preventDefault();
  if (currentScreen === 'welcome') { enterPortal(); return; }
  const nb = document.getElementById('next-btn');
  if (nb.classList.contains('visible')) nextQuestion();
  else if (currentScreen === 'iscreen-close') returnToPortal();
});

let ty = 0;
document.addEventListener('touchstart', e => { ty = e.touches[0].clientY; }, { passive:true });
document.addEventListener('touchend', e => {
  const nb = document.getElementById('next-btn');
  if (e.changedTouches[0].clientY < ty - 55 && nb.classList.contains('visible')) nextQuestion();
});
</script>
</body>
</html>
